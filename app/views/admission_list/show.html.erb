<ul class="nav nav-tabs" id="learnerTabs" role="tablist">
  <li class="nav-item" role="presentation">
    <button class="nav-link active" id="general-info-tab" data-bs-toggle="tab" data-bs-target="#general-info" type="button" role="tab" aria-controls="general-info" aria-selected="true">
      <h2 class="h5 mb-0">General Info</h2>
    </button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" id="documents-tab" data-bs-toggle="tab" data-bs-target="#documents" type="button" role="tab" aria-controls="documents" aria-selected="false">
      <h2 class="h5 mb-0">Documents</h2>
    </button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" id="logs-tab" data-bs-toggle="tab" data-bs-target="#logs" type="button" role="tab" aria-controls="logs" aria-selected="false">
      <h2 class="h5 mb-0">Activity Log</h2>
    </button>
  </li>
</ul>

<div class="tab-content mt-4" id="learnerTabsContent">
  <div class="tab-pane fade show active" id="general-info" role="tabpanel" aria-labelledby="general-info-tab">
    <div class="px-4">
      <%= render 'learner_info' %>
    </div>
  </div>

  <div class="tab-pane fade" id="documents" role="tabpanel" aria-labelledby="documents-tab">
    <div class="px-4">
      <%= render 'learner_documents' %>
    </div>
  </div>

  <div class="tab-pane fade" id="logs" role="tabpanel" aria-labelledby="logs-tab">
    <div class="px-4">
      <%= render 'logs' %>
    </div>
  </div>
</div>

<script>
  function activateLearnerTab() {
    // read active_tab param (expected values: "general-info" or "documents")
    const urlParams = new URLSearchParams(window.location.search);
    const activeTab = urlParams.get('active_tab');

    if (activeTab) {
      document.querySelectorAll('.nav-link').forEach(tab => {
        tab.classList.remove('active');
        tab.setAttribute('aria-selected', 'false');
      });
      document.querySelectorAll('.tab-pane').forEach(pane => {
        pane.classList.remove('show', 'active');
      });

      const targetTab = document.querySelector(`#${activeTab}-tab`);
      const targetPane = document.querySelector(`#${activeTab}`);

      if (targetTab && targetPane) {
        targetTab.classList.add('active');
        targetTab.setAttribute('aria-selected', 'true');
        targetPane.classList.add('show', 'active');
      }
    }
  }

  document.addEventListener('DOMContentLoaded', activateLearnerTab);

  document.addEventListener('turbo:load', function() {
    if (typeof activateLearnerTab === 'function') {
      try { activateLearnerTab(); } catch (e) { console.error('activateLearnerTab error', e); }
    }

    if (typeof bootstrap !== 'undefined' && bootstrap.Tooltip) {
      var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
      tooltipTriggerList.forEach(function (el) { new bootstrap.Tooltip(el) });
    }
  });
</script>

<style>
  .nav-tabs .nav-link.active { color: #000 !important; }
  .nav-tabs .nav-link { color: lightgrey !important; }
</style>
