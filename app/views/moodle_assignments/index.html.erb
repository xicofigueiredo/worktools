<h1>Moodle Assignments</h1>

<div class="mb-3">
  <%= form_with url: fetch_submissions_range_moodle_assignments_path, method: :post, local: true, class: 'form-inline' do |f| %>
    <div class="form-group mr-2">
      <label for="first" class="mr-1">First</label>
      <%= number_field_tag :first, params[:first], min: 0, class: 'form-control', id: 'first' %>
    </div>
    <div class="form-group mr-2">
      <label for="last" class="mr-1">Last</label>
      <%= number_field_tag :last, params[:last], min: 1, class: 'form-control', id: 'last' %>
    </div>
    <%= submit_tag 'Fetch submissions for range', class: 'btn btn-primary' %>
  <% end %>
</div>

<% grouped = (@subject_rows || []).group_by { |r| r.category } %>

<% grouped.each do |category, rows| %>
  <h3><%= Subject.category_options[category.to_sym] rescue category %></h3>
  <table class="table table-striped table-sm">
    <thead>
      <tr>
        <th>Subject</th>
        <th class="text-right">Assignments</th>
        <th class="text-right">Submissions</th>
      </tr>
    </thead>
    <tbody>
      <% rows.each do |r| %>
        <tr>
          <td>
            <%= link_to r.subject_name, subject_moodle_assignments_path(id: r.subject_id) %>
          </td>
          <td class="text-right"><%= r.assignments_count %></td>
          <td class="text-right"><%= r.submissions_count %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% end %>
