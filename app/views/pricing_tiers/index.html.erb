<div class="container-fluid">
  <div class="row min-vh-100">

    <div class="col-md-2 border-end py-4">
      <h6 class="px-3 text-uppercase text-muted small fw-bold mb-3">Countries</h6>
      <div class="list-group list-group-flush">
        <% @countries.each do |country| %>
          <%= link_to country,
              pricing_tiers_path(year: @selected_year, country: country, hub_type: @selected_hub_type),
              class: "list-group-item list-group-item-action border-0 px-3 py-2 rounded #{'active fw-bold' if country == @selected_country}" %>
        <% end %>
      </div>
    </div>

    <div class="col-md-10 py-4 px-md-5">

      <div class="mb-4">
        <ul class="nav nav-pills justify-content-center">
          <% @years.each do |year| %>
            <li class="nav-item mx-1">
              <%= link_to year,
                  pricing_tiers_path(year: year, country: @selected_country, hub_id: @selected_hub_id, hub_type: @selected_hub_type),
                  class: "nav-link px-4 #{'active shadow-sm' if year == @selected_year}" %>
            </li>
          <% end %>
        </ul>
      </div>

      <% if @available_hubs.any? %>
        <ul class="nav nav-tabs border-bottom-0 ms-1">
          <% @available_hubs.each do |hub| %>
            <% is_active = (hub[:hub_id].to_s == @selected_hub_id.to_s && hub[:type] == @selected_hub_type) %>
            <li class="nav-item">
              <%= link_to hub[:name],
                  pricing_tiers_path(year: @selected_year, country: @selected_country, hub_id: hub[:hub_id], hub_type: hub[:type]),
                  class: "nav-link #{'active fw-bold' if is_active} #{'text-muted' unless is_active}" %>
            </li>
          <% end %>
        </ul>
      <% end %>

      <div class="card shadow-sm border-0 mb-5">
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-hover align-middle mb-0 text-center">
              <thead class="bg-light">
                <tr>
                  <th class="text-start ps-4 py-3 text-secondary text-uppercase small" style="width: 25%;">Curriculum</th>
                  <th class="py-3 text-secondary text-uppercase small">Admission</th>
                  <th class="py-3 text-secondary text-uppercase small">Monthly</th>
                  <th class="py-3 text-secondary text-uppercase small">Renewal</th>
                  <th class="py-3 text-secondary text-uppercase small">Invoice To</th>
                  <th class="py-3 text-secondary text-uppercase small">Notes</th>
                  <th class="py-3 text-secondary text-uppercase small">Actions</th>
                </tr>
              </thead>
              <tbody>
                <% if @curriculums.empty? %>
                  <tr>
                    <td colspan="6" class="py-5 text-muted">No pricing data found for this selection.</td>
                  </tr>
                <% else %>
                  <% @curriculums.each do |curr| %>
                    <% tier = @matrix_tiers[curr] %>
                    <tr>
                      <td class="text-start ps-4 fw-bold text-dark"><%= curr %></td>

                      <td class="text-dark">
                        <% if tier.admission_fee.to_f.positive? %>
                          <%= tier.currency_symbol %><%= number_with_precision(tier.admission_fee, precision: 2) %>
                        <% else %>
                          -
                        <% end %>
                      </td>

                      <td class="text-dark">
                        <% if tier.monthly_fee.to_f.positive? %>
                          <%= tier.currency_symbol %><%= number_with_precision(tier.monthly_fee, precision: 2) %>
                        <% else %>
                          -
                        <% end %>
                      </td>

                      <td class="text-dark">
                        <% if tier.renewal_fee.to_f.positive? %>
                          <%= tier.currency_symbol %><%= number_with_precision(tier.renewal_fee, precision: 2) %>
                        <% else %>
                          -
                        <% end %>
                      </td>

                      <td class="text-dark">
                         <%= tier.invoice_recipient.presence || "-" %>
                      </td>

                      <td class="text-dark small">
                        <%= tier.notes.presence || "-" %>
                      </td>

                      <td>
                        <%= button_to pricing_tier_path(tier),
                            method: :delete,
                            class: "btn btn-danger d-inline-flex align-items-center justify-content-center p-0 shadow-sm",
                            style: "width: 32px; height: 32px; border-radius: 4px;",
                            title: "Delete",
                            data: {
                              confirm: "Are you sure you want to delete the #{curr} pricing tier? This cannot be undone.",
                              turbo_confirm: "Are you sure you want to delete the #{curr} pricing tier? This cannot be undone.",
                              bs_toggle: "tooltip"
                            } do %>
                          <i class="fas fa-trash"></i>

                        <% end %>
                      </td>
                    </tr>
                  <% end %>
                <% end %>
              </tbody>
            </table>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function(){
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
      return new bootstrap.Tooltip(tooltipTriggerEl)
    })
  });
</script>
