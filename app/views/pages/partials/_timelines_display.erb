<div class="mb-5">
  <div class="card mb-2 shadow-sm px-2 responsive-card" style="border-radius: 10px">
    <div class="px-2 overflow-auto">
      <table class="table">
        <thead>
          <tr>
            <th>Subject</th>
            <th>Progress</th>
            <th>+/-</th>
            <th>Start Date</th>
            <th>Mock 50%</th>
            <th>Mock 100%</th>
            <th>End Date</th>
            <% if @has_exam_date %>
              <th>Exam Season</th>
            <% end %>
          </tr>
        </thead>
        <tbody>
          <% if @timelines.any? %>
            <% @timelines.each do |timeline| %>
              <%# Compute exam season display if needed %>
              <% exam_season = if timeline.exam_date.present?
                                   case timeline.exam_date.date.month
                                   when 5, 6
                                     "May/Jun #{timeline.exam_date.date.strftime('%Y')}"
                                   when 10, 11
                                     "Oct/Nov #{timeline.exam_date.date.strftime('%Y')}"
                                   else
                                     timeline.exam_date.date.strftime("%B %Y")
                                   end
                                 else
                                   "N/A"
                                 end %>
              <tr>
                <td style="text-align: left;">
                  <%= timeline.subject.name.present? ? timeline.subject.name : timeline.personalized_name %>
                </td>
                <td>
                  <div style="font-weight: bold;">
                    <%= timeline.progress %>%
                  </div>
                </td>
                <td>
                  <% if timeline.expected_progress.present? && timeline.progress.present? %>
                    <% if timeline.progress > timeline.expected_progress %>
                      <div class="badge rounded-pill bg-success">
                        +<%= timeline.progress - timeline.expected_progress %>%
                      </div>
                    <% elsif timeline.progress < timeline.expected_progress %>
                      <div class="badge rounded-pill bg-danger">
                        <%= timeline.progress - timeline.expected_progress %>%
                      </div>
                    <% else %>
                      <div class="badge rounded-pill bg-success">0%</div>
                    <% end %>
                  <% end %>
                </td>
                <td><%= timeline.start_date.strftime("%d/%m/%Y") %></td>
                <% if timeline.mock50.present? %>
                  <td><%= timeline.mock50.strftime("%d/%m/%Y") %></td>
                <% else %>
                  <td></td>
                <% end %>
                <% if timeline.mock100.present? %>
                  <td><%= timeline.mock100.strftime("%d/%m/%Y") %></td>
                <% else %>
                  <td></td>
                <% end %>
                <td><%= timeline.end_date.strftime("%d/%m/%Y") %></td>
                <% if @has_exam_date %>
                  <td><%= exam_season %></td>
                <% end %>
              </tr>
            <% end %>
          <% else %>
            <% colspan_val = @has_exam_date ? 8 : 7 %>
            <tr>
              <td colspan="<%= colspan_val %>">
                <div class="text-center py-5">
                  <h2>No Timelines available...</h2>
                  <p>Please help <%= @learner.full_name %> set up their timelines.</p>
                </div>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div>
