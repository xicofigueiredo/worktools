<div class="container mt-3">
  <h2>Notes</h2>
  <p>Check all of <%= @learner.full_name %>'s notes below:</p>

  <div class="d-flex gap-3 justify-content-end">
    <!-- Button to create a new note -->
    <div class="d-flex justify-content-end mb-3">
      <%= link_to 'Create New Note', new_user_note_path(@learner),
          data: { turbo_frame: "modal" },
          class: 'btn btn-primary',
          style: 'border-radius: 10px;' %>
    </div>

    <!-- back button -->
    <div class="d-flex justify-content-end mb-3">
      <%= link_to 'Back', learner_profile_path(@learner), class: 'btn btn-secondary', style: 'border-radius: 10px;' %>
    </div>
  </div>

  <% notes_by_month = @notes.group_by { |note| note.date.beginning_of_month } %>
  <% if notes_by_month.any? %>
    <% notes_by_month.sort.reverse.each do |month, notes| %>
      <div class="month-section mb-5">
        <h4 class="mb-3"><%= month.strftime("%B %Y") %></h4>
        <div class="card shadow-sm mb-3" style="border-radius: 10px;">
          <div class="card-body p-2">
            <!-- Single scrollable container for this month's notes -->
            <div class="table-responsive" style="max-height: 700px; overflow-y: auto;">
              <table class="table" style="table-layout: fixed; width: 100%;">
                <thead>
                  <tr>
                    <th class="lp-notes-category-width">Category</th>
                    <th class="lp-notes-topic-width">Topic</th>
                    <th>Follow-up Action</th>
                    <th class="lp-notes-status-width">Status</th>
                    <th style="width: 50px;">Edit</th>
                  </tr>
                </thead>
                <tbody>
                  <% notes.each do |note| %>
                    <tr>
                      <td class="lp-notes-category-width">
                        <p class="mb-2"><%= note.category.capitalize %></p>
                        <p><%= note.date.strftime("%d/%m/%Y") %></p>
                      </td>
                      <td class="lp-notes-topic-width"><%= note.topic %></td>
                      <td style="max-width: 250px;"><%= note.follow_up_action %></td>
                      <td class="lp-notes-status-width">
                        <%= form_with model: [note.user, note], remote: true do |f| %>
                          <%= f.select :status, ['Not Done', 'In Progress', 'Completed'], {}, {
                                onchange: "this.form.submit();"
                              } %>
                        <% end %>
                      </td>
                      <td style="width: 50px;">
                        <%= link_to edit_user_note_path(@learner, note), data: { turbo_frame: "modal" } do %>
                          <i class="fa-solid fa-pencil"></i>
                        <% end %>
                      </td>
                    </tr>
                  <% end %>
                </tbody>
              </table>
            </div> <!-- end .table-responsive -->
          </div>
        </div>
      </div>
    <% end %>
  <% else %>
    <div class="text-center py-5">
      <h2>No Notes available...</h2>
      <p>Click on 'Create New Note' button to create a new note</p>
    </div>
  <% end %>
</div>
