<div class="container-fluid px-3 my-4">
  <% if notice %>
    <div class="alert alert-success"><%= notice %></div>
  <% end %>
  <% if alert %>
    <div class="alert alert-danger"><%= alert %></div>
  <% end %>

  <% if current_user.managed_departments.present? %>
    <ul class="nav nav-tabs" id="leavesTabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="my-leaves-tab" data-bs-toggle="tab" data-bs-target="#my-leaves" type="button" role="tab" aria-controls="my-leaves" aria-selected="true">
          <h2>My Leaves</h2>
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="manager-tab" data-bs-toggle="tab" data-bs-target="#manager" type="button" role="tab" aria-controls="manager" aria-selected="false">
          <h2>Manager Dashboard</h2>
        </button>
      </li>
    </ul>

    <div class="tab-content mt-4" id="leavesTabsContent">
      <div class="tab-pane fade show active" id="my-leaves" role="tabpanel" aria-labelledby="my-leaves-tab">
        <div class="px-4">
          <%= render 'entitlements' %>
          <%= render 'leave_requests', leaves: @user_leaves %>
        </div>
      </div>

      <div class="tab-pane fade" id="manager" role="tabpanel" aria-labelledby="manager-tab">
        <div class="px-4">
          <%= render 'pending_confirmations' %>
          <%= render 'department_entitlements' %>
          <%= render 'department_holidays' %>
          <% if @show_hr_view %>
            <%= render 'hr_calendar' %>
          <% end %>
        </div>
      </div>
    </div>
  <% else %>
    <div class="px-4">
      <%= render 'entitlements' %>
      <%= render 'leave_requests', leaves: @user_leaves %>
    </div>
  <% end %>
</div>

<script>
  function activateTab() {
    // Get the active tab from URL parameters
    const urlParams = new URLSearchParams(window.location.search);
    const activeTab = urlParams.get('active_tab');

    if (activeTab) {
      // Remove active class from all tabs
      document.querySelectorAll('.nav-link').forEach(tab => {
        tab.classList.remove('active');
        tab.setAttribute('aria-selected', 'false');
      });

      // Remove active class from all tab panes
      document.querySelectorAll('.tab-pane').forEach(pane => {
        pane.classList.remove('show', 'active');
      });

      // Activate the specified tab
      const targetTab = document.querySelector(`#${activeTab}-tab`);
      const targetPane = document.querySelector(`#${activeTab}`);

      if (targetTab && targetPane) {
        targetTab.classList.add('active');
        targetTab.setAttribute('aria-selected', 'true');
        targetPane.classList.add('show', 'active');
      }
    }
  }

  // Run on initial page load
  document.addEventListener('DOMContentLoaded', activateTab);

  document.addEventListener('turbo:load', function() {
    if (typeof activateTab === 'function') {
      try { activateTab() } catch (e) { console.error('activateTab() error', e) }
    }

    // If Bootstrap is present, initialise all tooltips
    if (typeof bootstrap !== 'undefined' && bootstrap.Tooltip) {
      var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
      tooltipTriggerList.forEach(function (el) { new bootstrap.Tooltip(el) })
    }
  })
</script>

<style>
  .nav-tabs .nav-link.active {
    color: #000 !important;
  }
  .nav-tabs .nav-link {
    color: lightgrey !important;
  }
</style>
