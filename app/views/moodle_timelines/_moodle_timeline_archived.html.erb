<%# Determine if this timeline uses LWS based on its subject category %>
<% is_lws = moodle_timeline.subject.category&.include?("lws") %>
<div>
  <h2>
    <div class="d-flex">
      <div class="col-8">
        <div class="card shadow-sm m-2 p-2" style="border-radius: 10px;">
          <div class="d-flex justify-content-between">
            <h5>
              <%= moodle_timeline.subject.name.present? ? moodle_timeline.subject.name : moodle_timeline.personalized_name %>
              <% unless is_lws || moodle_timeline.personalized_name.present? %>
                <% if moodle_timeline.balance > 0 %>
                  <div class="badge rounded-pill bg-success">+<%= moodle_timeline.balance %></div>
                <% elsif moodle_timeline.balance < 0 %>
                  <div class="badge rounded-pill bg-danger"><%= moodle_timeline.balance %></div>
                <% else %>
                  <div class="badge rounded-pill bg-warning">On time</div>
                <% end %>
              <% end %>
            </h5>
            <div>
              <% if moodle_timeline.hidden %>
                <%= link_to toggle_archive_moodle_timeline_path(moodle_timeline), data: { turbo_method: :patch, turbo_confirm: "Reactivate #{moodle_timeline.subject.name}?" } do %>
                  <i class="fa-solid fa-trash-can-arrow-up" title="Unarchive" style="font-size: 20px; color: #808080;"></i>
                <% end %>
              <% else %>
                <%= link_to toggle_archive_timeline_path(moodle_timeline), data: { turbo_method: :patch, turbo_confirm: "Archive #{moodle_timeline.subject.name}?" } do %>
                  <i class="fa-solid fa-box-archive" title="Archive" style="font-size: 20px; color: #808080;"></i>
                <% end %>
              <% end %>
            </div>
          </div>
          <div class="d-flex justify-content-between align-middle">
            <div>
              <div class="d-flex gap-3">
                <p class="mb-1" style="color: gray; font-size: 16px;">Start Date:</p>
                <p style="font-size: 16px;"><%= moodle_timeline.start_date.strftime('%d-%m-%Y') %></p>
              </div>
              <div class="d-flex gap-3">
                <p class="mb-1" style="color: gray; font-size: 16px;">End Date:</p>
                <p style="font-size: 16px;"><%= moodle_timeline.end_date.strftime('%d-%m-%Y') %></p>
              </div>
            </div>
            <div style="margin-block: auto;">
              <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapse<%= index %>" aria-expanded="false" aria-controls="collapse<%= index %>" style="border-radius: 10px;"></button>
            </div>
          </div>
          <div class="progress" role="progressbar" aria-label="Progress bar" aria-valuenow="<%= moodle_timeline.progress %>" aria-valuemin="0" aria-valuemax="100" style="border-radius: 10px;">
            <div class="progress-bar" style="width: <%= moodle_timeline.progress > 5 ? moodle_timeline.progress : 4 %>%; border-radius: 10px;"> <%= moodle_timeline.progress %>% </div>
          </div>
        </div>
      </div>
    </div>
  </h2>
</div>
